version: 1
backend:
  phases:
    preBuild:
      commands:
        - echo "Starting preBuild phase"
        - python --version
        - pip --version
    build:
      commands:
        - echo "Starting build phase"
        
        # Install dependencies with pip - specific order for compatibility
        - pip install --upgrade pip
        - pip install pydantic==1.10.13
        - pip install -r requirements.txt
        
        # Create static directory if it doesn't exist
        - mkdir -p static
        
        # Copy app static files to the project static directory
        - if [ -d "megbot/static" ]; then cp -r megbot/static/* static/; fi
        
        # Environment setup
        - echo "SECRET_KEY=temp-key-for-build-process-only" > .env
        - echo "DEBUG=False" >> .env
        - export DJANGO_SETTINGS_MODULE=chatbot_project.settings
        - export PYTHONPATH=$(pwd)
        
        # Run Django check
        - python manage.py check
        
        # Collect static files
        - python manage.py collectstatic --noinput
  artifacts:
    baseDirectory: /
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*